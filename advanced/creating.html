
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Creating software containers &#8212; Docker for neuroscience</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'advanced/creating';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Software containers &amp; data" href="data.html" />
    <link rel="prev" title="Management of software containers" href="management.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Docker for neuroscience</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../dei.html">Diversity, Equity and Inclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Workshop overview</a></li>

<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup for the workshop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../outline.html">Outline</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../prerequisites.html">Course prerequisites</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../prerequisites/intro_to_shell.html">Prerequisite - the (unix) command line: bash</a></li>









</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basics/introduction.html">Introduction - Container &amp; Virtualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/quickstart.html">Quickstarting your container expertise</a></li>
<li class="toctree-l1"><a class="reference internal" href="management.html">Management of software containers</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Creating software containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Software containers &amp; data</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_your_own.html">Creating your own software container</a></li>
<li class="toctree-l1"><a class="reference internal" href="automating.html">Automating software containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CoC.html">Code of Conduct</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/M-earnest/docker_workshop" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/M-earnest/docker_workshop/edit/main/workshop/advanced/creating.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/M-earnest/docker_workshop/issues/new?title=Issue%20on%20page%20%2Fadvanced/creating.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/advanced/creating.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Creating software containers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-there-and-back-again">Docker - there and back again</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-containers-the-creation">Docker containers - the creation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dockerfiles">Dockerfiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-dockerfile">Building a Dockerfile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-baseimage">1. FROM - Baseimage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#workdir-working-directory">2. WORKDIR - working directory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-install-software-execute-commands">3. RUN - install software, execute commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copy-add-files-to-image">4. COPY - add files to image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#entrypoint-and-cmd-make-the-image-exectuable">5. Entrypoint and CMD - make the image exectuable</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-example">Practical example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#virtualizing-a-workflow">Virtualizing a workflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#neurodocker">Neurodocker</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#neurodocker-going-further-beyond">Neurodocker - Going further beyond</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-push">Docker push</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-containers-creating-and-pushing-a-recap">Docker containers - creating and pushing - a recap</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="creating-software-containers">
<h1>Creating software containers<a class="headerlink" href="#creating-software-containers" title="Link to this heading">#</a></h1>
<section id="learning-objectives">
<h2>Learning objectives<a class="headerlink" href="#learning-objectives" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>learn the architecture of a docker image</p></li>
<li><p>learn what a dockerfile and a build context are</p></li>
<li><p>learn how to build, run and share a docker container</p></li>
<li><p>learn how to make your (professional life easier) by using <a class="reference external" href="https://www.repronim.org/neurodocker/user_guide/examples.html">Neurodocker</a></p></li>
</ul>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>a working version of <a class="reference external" href="https://docs.docker.com/get-docker/">Docker</a></p></li>
<li><p>a Docker Hub and GitHub account</p></li>
<li><p>access to a <a class="reference external" href="https://en.wikipedia.org/wiki/Unix_shell">Unix terminal/shell</a></p></li>
<li><p>minimal understanding of BASH, i.e. primarily the <code class="docutils literal notranslate"><span class="pre">pwd</span></code>, <code class="docutils literal notranslate"><span class="pre">ls</span></code>  and <code class="docutils literal notranslate"><span class="pre">cd</span></code> commands. (Check the <a class="reference internal" href="#lhttps://m-earnest.github.io/docker_workshop/prerequisites.html"><span class="xref myst">refresher section</span></a> to catch up!)</p></li>
</ul>
</section>
<section id="docker-there-and-back-again">
<h2>Docker - there and back again<a class="headerlink" href="#docker-there-and-back-again" title="Link to this heading">#</a></h2>
<p>So far, we (hopefully) got to know how docker works, how containers can be downloaded, used and managed. Next, we’ll learn how to create docker containers for our own work, including all the necessary dependencies to make your workflow truly reproducible. As a heads-up, most of the infos here are distilled from the <a class="reference external" href="https://docs.docker.com/reference/dockerfile/">dockerfile reference page</a>, which is great resource if you’re looking for more in-depth explanations for the following lesson.</p>
<p>We will still be relying on the <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">line</span></code> and <code class="docutils literal notranslate"><span class="pre">bash</span></code> from here on out, if this seems like gibberish to you, please go through the <a class="reference external" href="https://m-earnest.github.io/docker_workshop/prerequisites/intro_to_shell.html">course prerequisites - Introduction to the (unix) command line: bash</a>.</p>
</section>
<section id="docker-containers-the-creation">
<h2>Docker containers - the creation<a class="headerlink" href="#docker-containers-the-creation" title="Link to this heading">#</a></h2>
<p>When it comes to creating docker containers, two essential parts are relevant:</p>
<ul class="simple">
<li><p>a Dockerfile</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code> command</p></li>
</ul>
</section>
<section id="dockerfiles">
<h2>Dockerfiles<a class="headerlink" href="#dockerfiles" title="Link to this heading">#</a></h2>
<p>At the beginning there was a Dockerfile…</p>
<p>A Dockerfile is, in essence, a machine-readable instruction on how to build a docker iamge. It can be considered as the “source code” of a docker container.</p>
<p>The Dockerfile usually includes a mixture of <code class="docutils literal notranslate"><span class="pre">bash</span></code> commands, that you would also normally use on your machine to e.g. setup a <a class="reference internal" href="../advanced.html"><span class="doc std std-doc">Conda enviornment</span></a> or to install specific software, and docker specific commands (called instructions). Below you’ll find a list of acceptable Docker instructions are, if the terminology is condusing or you want to dive deeper into what the different commands are and how they are used check out the <a class="reference external" href="https://docs.docker.com/engine/reference/builder/">Docker build documentation</a>. We’ll only make use of a few relevant commands for this tutorial that we will explain in detail below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Instruction</span>

<span class="n">ADD</span> <span class="o">-</span> <span class="n">Add</span> <span class="n">local</span> <span class="ow">or</span> <span class="n">remote</span> <span class="n">files</span> <span class="ow">and</span> <span class="n">directories</span><span class="o">.</span>
<span class="n">ARG</span> <span class="o">-</span> <span class="n">Use</span> <span class="n">build</span><span class="o">-</span><span class="n">time</span> <span class="n">variables</span><span class="o">.</span>
<span class="n">CMD</span> <span class="o">-</span> <span class="n">Specify</span> <span class="n">default</span> <span class="n">commands</span><span class="o">.</span>
<span class="n">COPY</span> <span class="o">-</span> <span class="n">Copy</span> <span class="n">files</span> <span class="ow">and</span> <span class="n">directories</span><span class="o">.</span>
<span class="n">ENTRYPOINT</span> <span class="o">-</span> <span class="n">Specify</span> <span class="n">default</span> <span class="n">executable</span><span class="o">.</span>
<span class="n">ENV</span> <span class="o">-</span> <span class="n">Set</span> <span class="n">environment</span> <span class="n">variables</span><span class="o">.</span>
<span class="n">EXPOSE</span> <span class="o">-</span> <span class="n">Describe</span> <span class="n">which</span> <span class="n">ports</span> <span class="n">your</span> <span class="n">application</span> <span class="ow">is</span> <span class="n">listening</span> <span class="n">on</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span> <span class="k">for</span> <span class="n">interactions</span> <span class="k">with</span> <span class="n">the</span> <span class="n">users</span> <span class="n">filesystem</span><span class="o">.</span>
<span class="n">FROM</span> <span class="o">-</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">new</span> <span class="n">build</span> <span class="n">stage</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">base</span> <span class="n">image</span><span class="o">.</span>
<span class="n">HEALTHCHECK</span> <span class="o">-</span> <span class="n">Check</span> <span class="n">a</span> <span class="n">containers</span> <span class="n">health</span> <span class="n">on</span> <span class="n">startup</span><span class="o">.</span>
<span class="n">LABEL</span> <span class="o">-</span> <span class="n">Add</span> <span class="n">metadata</span> <span class="n">to</span> <span class="n">an</span> <span class="n">image</span><span class="o">.</span>
<span class="n">MAINTAINER</span> <span class="o">-</span> <span class="n">Specify</span> <span class="n">the</span> <span class="n">author</span> <span class="n">of</span> <span class="n">an</span> <span class="n">image</span><span class="o">.</span>
<span class="n">ONBUILD</span> <span class="o">-</span> <span class="n">Specify</span> <span class="n">instructions</span> <span class="k">for</span> <span class="n">when</span> <span class="n">the</span> <span class="n">image</span> <span class="ow">is</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">build</span><span class="o">.</span>
<span class="n">RUN</span> <span class="o">-</span> <span class="n">Execute</span> <span class="n">build</span> <span class="n">commands</span><span class="o">.</span>
<span class="n">USER</span>	<span class="n">Set</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">group</span> <span class="n">ID</span><span class="o">.</span>
<span class="n">VOLUME</span>	<span class="n">Create</span> <span class="n">volume</span> <span class="n">mounts</span><span class="o">.</span>
<span class="n">WORKDIR</span>	<span class="n">Change</span> <span class="n">working</span> <span class="n">directory</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="building-a-dockerfile">
<h2>Building a Dockerfile<a class="headerlink" href="#building-a-dockerfile" title="Link to this heading">#</a></h2>
<p>The following will be a step-by-step guide on how to create a Dockerfile and how to populate our file with the necessary instructions to build a Docker container. Each separate instruction is called a “layer”. Layers are executed consecutively from to to bottom, when using the build command to compose an Docker Image.</p>
<p>Here are the relevant <em>layers</em> we’re going to build, i.e how our Dockerfile is going to look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Step 1: Use the newest Ubuntu version as a base image</span>
    <span class="n">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">latest</span>

    <span class="c1"># Step 2: Set the working directory</span>
    <span class="n">WORKDIR</span> <span class="o">/</span><span class="n">project</span>

    <span class="c1"># Step 3: Install Python 3.10, and some Python packages (Scipy, Pandas) via the Ubuntu package manager apt</span>
    <span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> \
        <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span><span class="mf">.10</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span> <span class="o">&amp;&amp;</span> \
        <span class="n">pip3</span> <span class="n">install</span> <span class="n">pandas</span>

    <span class="c1"># let&#39;s also create  a folder to store our info file in</span>
    <span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">info</span>

    <span class="c1"># Step 4: Copy our Python script and README into the info folder of the image</span>
    <span class="n">COPY</span> <span class="n">print_info</span><span class="o">.</span><span class="n">py</span> <span class="o">/</span><span class="n">info</span><span class="o">/</span>
    <span class="n">COPY</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span> <span class="o">/</span><span class="n">info</span><span class="o">/</span><span class="n">README</span><span class="o">.</span><span class="n">md</span>

    <span class="c1"># Step 5: Specify the default command when the image is run, e.g. to print the contents of the readme file </span>
    <span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;/info/README.md&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>So, let’s explain this step-by-step and bring it all together with a practical example.</p>
</section>
<section id="from-baseimage">
<h2>1. FROM - Baseimage<a class="headerlink" href="#from-baseimage" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">FROM</span> <span class="pre">ubuntu:latest</span></code></p>
<p>The “From” command defines the OS architecture that your image is supposed to use, e.g. Ubuntu 20.04. This will be referred to as the “base” or “baseimage” of a container. At times we will also use the ‘From’ command to call specific packages or environment managers, such as Conda. In this, case a specific OS  will be defined in the respective image that the ‘from’ command points to, e.g when calling ‘FROM continuumio/miniconda3’, the minconda3 image will have a specific OS defined.</p>
<p>It is also possible to use the ‘From’ command to chain multiple Docker images or more complex building steps together, for our purposes this is rarely necessary. You can find more info on Multi-stage builds <a class="reference external" href="https://docs.docker.com/build/building/multi-stage/">here</a>.</p>
</section>
<section id="workdir-working-directory">
<h2>2. WORKDIR - working directory<a class="headerlink" href="#workdir-working-directory" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">WORKDIR</span> <span class="pre">/project</span></code></p>
<p>The WORKDIR instruction sets the working directory for any of the other instructions that follow it in the Dockerfile (e.g. RUN, CMD, ENTRYPOINT, COPY, etc.)</p>
<ul>
<li><p>it further is the directory you will likely mount from your host system for input/output operations, facilitating data exchange between your container and host (If the specified directory does not exist on your system, Docker will create it automatically)</p>
<ul>
<li><p>the only argument we provide is a concise, descriptive name for the folder/folder structure, e.g.</p>
<p><code class="docutils literal notranslate"><span class="pre">/project</span></code></p>
</li>
</ul>
</li>
</ul>
<p><strong>Note:</strong> Be cautious if you mount a directory from your local machine onto the WORKDIR. The originally contained files cannot be accessed anymore as they will be replaced with the contents of your local directory. To circumvent this you can set the WORKDIR multiple times in a script or e.g. simply create a folder strcuture where you’ll store you scripts and use the WORKDIR as the input/output directory for your data.</p>
</section>
<section id="run-install-software-execute-commands">
<h2>3. RUN - install software, execute commands<a class="headerlink" href="#run-install-software-execute-commands" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> \
        <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span><span class="mf">.10</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span> <span class="o">&amp;&amp;</span> \
        <span class="n">pip3</span> <span class="n">install</span> <span class="n">pandas</span>

    <span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">info</span>
</pre></div>
</div>
<p>In the installation instructions, we want to provide information on what software/packages we want to install to run our workflow. Using the Ubuntu baseimage we can make use of the standard package managers ‘pip’ and ‘apt-get’ in the same way we would use them in our bash shell.</p>
<p>For this we’ll make use of the <code class="docutils literal notranslate"><span class="pre">RUN</span></code> instruction, which will execute any specified command to create a new layer.</p>
<p>So to install e.g. Python using the Ubuntu baseimage and apt package manager we would write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span><span class="mf">.10</span>
</pre></div>
</div>
<p><strong>Important</strong>: RUN is a build command, if you want to execute certain scripts/code when a container is run refere to point 5.</p>
<p><strong>Note</strong>: You should always combine RUN apt-get update with apt-get install in the same statement, as otherwise you may run into cache issues (more info <a class="reference external" href="https://docs.docker.com/develop/develop-images/instructions/#apt-get">here</a>)</p>
</section>
<section id="copy-add-files-to-image">
<h2>4. COPY - add files to image<a class="headerlink" href="#copy-add-files-to-image" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">COPY</span> <span class="n">print_info_container</span><span class="o">.</span><span class="n">py</span> <span class="o">/</span><span class="n">info</span><span class="o">/</span>
    <span class="n">COPY</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span> <span class="o">/</span><span class="n">info</span><span class="o">/</span><span class="n">README</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
<p>Using the COPY instruction we can permanently add files from our local system to our Docker Image.</p>
<ul>
<li><p>simply provide the path to the files you want to copy and the directory were they are supposed to be stored in the image</p></li>
<li><p>e.g. if i want to add a script “print_info_container.py” from the curent working directory into the project folder of the image:</p>
<p><code class="docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">print_info_container.py</span> <span class="pre">/project/</span></code></p>
</li>
</ul>
</section>
<section id="entrypoint-and-cmd-make-the-image-exectuable">
<h2>5. Entrypoint and CMD - make the image exectuable<a class="headerlink" href="#entrypoint-and-cmd-make-the-image-exectuable" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">CMD</span> <span class="pre">[&quot;cat&quot;,</span> <span class="pre">&quot;/info/README.md&quot;]</span></code></p>
<p>To make a docker image executable you’ll need to include either an ‘ENTRYPOINT’, an ‘CMD’ or a mixture of both instructions. These specify what should happen when a container starts, and what arguments can be passed to modify the behaviour of the container.</p>
<p>The ENTRYPOINT specifies a command that will always be executed when the container starts (i.e. this should be the “main” command), while CMD defines the default arguments of the container, e.g.</p>
<p><code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span> <span class="pre">[&quot;echo&quot;,</span> <span class="pre">&quot;Hello,</span> <span class="pre">World!&quot;]</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>or 
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CMD</span> <span class="pre">[&quot;echo&quot;,</span> <span class="pre">&quot;Hello,</span> <span class="pre">World!&quot;]</span></code></p>
<p>Given no further arguments when the container is run (after we’ve build it, of course), both of these will simply print “Hello World!”, but the behavior of the ‘CMD’ command can be overriden when the container is run with specific instruction, e.g. ‘docker run myimage Hello, Docker!’ prints “Hello, Docker!” instead of “Hello World!”.</p>
<p>A practical use case can be to combine both instructions, so that the entrypoint provides a command that is always exectued, while CMD provides arguments that the user might want to exchange, e.g. if we want our container to execute a python script, we simply provide command line argument “python” as our ENTRYPOINT and use CMD to specify a default name of the script.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">FROM</span> <span class="n">python</span><span class="p">:</span><span class="mf">3.10</span>
    <span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">]</span>
    <span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;script.py&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>If we now simply run this container using ‘docker run myimage’ it will try to locate and execute “<a class="reference external" href="http://script.py">script.py</a>”, if the user instead wants to run his python script called “my_script.py”, he can simply add this info to the run instruction, i.e. ‘docker run myimage python3 my_script.py’.</p>
<p>If you have more complex commands that should initally be run you can further provide bash scripts as your ENTRYPOINT like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">COPY</span> <span class="o">./</span><span class="n">docker</span><span class="o">-</span><span class="n">entrypoint</span><span class="o">.</span><span class="n">sh</span> <span class="o">/</span>
    <span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;/docker-entrypoint.sh&quot;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="practical-example">
<h2>Practical example<a class="headerlink" href="#practical-example" title="Link to this heading">#</a></h2>
<p>Let’s try this all together! The following docker image will simply print some info about the files in the image if using the deafult parameters but can additionaly function as a computing environment (Ubuntu, Python3.10) when our deafult commands are replaced.</p>
<p><strong>1. Create the build context</strong></p>
<p>Let’s create a new directory on our desktops called my_first_docker and in it an empty textfile called Dockerfile. Open your shell, type the following and hit enter</p>
<p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">~/Desktop/my_first_docker</span> <span class="pre">&amp;&amp;</span> <span class="pre">touch</span> <span class="pre">~/Desktop/my_first_docker/Dockerfile</span></code></p>
<p><strong>2. Add files to the build context</strong></p>
<p>Either download the course materials and copy all files from the examples folder into <code class="docutils literal notranslate"><span class="pre">my_first_docker</span> <span class="pre">folder</span></code> (<a class="reference external" href="http://README.md">README.md</a>, print_info_container.py, print_info_local_system.py).
Otherwise you’ll find the necessary files under <code class="docutils literal notranslate"><span class="pre">/docker_workshop_oldenburg/build_example/</span></code>, if you’ve pulled and ran the <code class="docutils literal notranslate"><span class="pre">get_workshop_materials:0.0.1</span></code> container from the <a class="reference external" href="https://m-earnest.github.io/docker_workshop/basics/quickstart.html">quickstart session</a>.</p>
<p>E.g. using bash:</p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/build_example/README.md</span> <span class="pre">/Users/me/Desktop/my_first_docker</span></code></p>
<p><strong>3. Populate the Dockerfile</strong></p>
<p>Open your Dockerfile with a text-editor of your choice (again VScode is recommended) and copy-paste the following into the file and save it</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Step 1: Use the newest Ubuntu version as a base image</span>
    <span class="n">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">latest</span>

    <span class="c1"># Step 2: Set the working directory</span>
    <span class="n">WORKDIR</span> <span class="o">/</span><span class="n">project</span>

    <span class="c1"># Step 3: Install Python 3.10, and some Python packages (Scipy, Pandas) via the Ubuntu package manager apt</span>
    <span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> \
        <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span><span class="mf">.10</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span> <span class="o">&amp;&amp;</span> \
        <span class="n">pip3</span> <span class="n">install</span> <span class="n">pandas</span>

    <span class="c1"># let&#39;s also create  a folder to store our info file in</span>
    <span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">info</span>

    <span class="c1"># Step 4: Copy our Python script and README into the info folder of the image</span>
    <span class="n">COPY</span> <span class="n">print_info</span><span class="o">.</span><span class="n">py</span> <span class="o">/</span><span class="n">info</span><span class="o">/</span>
    <span class="n">COPY</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span> <span class="o">/</span><span class="n">info</span><span class="o">/</span><span class="n">README</span><span class="o">.</span><span class="n">md</span>

    <span class="c1"># Step 5: Specify the default command when the image is run, e.g. to print the contents of the readme file </span>
    <span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;/info/README.md&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>4. Docker build</strong></p>
<p>Now that we’ve composed our Dockerfile, we can build our image via the ‘docker build’ command in the terminal.</p>
<p>For this we provide a name for our image via the <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">flag</span></code> and specify the path to our Dockerfile, resulting in e.g (given we’re in the my_first_docker folder).:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>`docker build -t myfirstdocker .`
</pre></div>
</div>
<div style="overflow-y: scroll; height: 200px; border: 1px solid #cccccc; padding: 5px; margin-bottom: 20px;">
  <p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(base) Michaels-MacBook-Pro:my_first_docker me$ sudo docker build -t my_first_docker .
[+] Building 1484.8s (9/9) FINISHED                  docker:desktop-linux  
=&gt; [internal] load .dockerignore		                                                                  0.0s 
=&gt; =&gt; transferring context: 2B 				                                                           	  0.0s 
=&gt; [internal] load build definition from Dockerfile		 	                                              0.0s
=&gt; =&gt; transferring dockerfile: 597B 				 	                                                  0.0s
=&gt; [internal] load metadata for docker.io/library/ubuntu:latest 	                                      0.0s
=&gt; [1/4] FROM docker.io/library/ubuntu:latest 			                                                  0.0s
=&gt; [internal] load build context 					                                                      0.0s
=&gt; =&gt; transferring context: 138B					                                                      0.0s
=&gt; CACHED [2/4] WORKDIR /project  				                                                          0.0s
=&gt; [3/4] RUN apt-get update &amp;&amp;     apt-get install -y python3.10 python3-pip &amp;&amp; pip3 install pandas    1483.5s
=&gt; [4/4] COPY print_info_container.py  /project/ 			                                                          0.0s
=&gt; [4/6] RUN mkdir /info                                                                                  0.1s
=&gt; [5/6] COPY print_info_container.py /info/                                                                        0.0s
=&gt; [6/6] COPY README.md /info/README.md                                                                   0.0s
=&gt; exporting to image						                                                              1.2s
=&gt; =&gt; exporting layers						                                                              1.2s
=&gt; =&gt; writing image sha256:c1891eb763de4c8432eae0d7239f7acd2f0d02782a5a4d87ec3f558f5c033ad6 	          0.0s 
=&gt; =&gt; naming to docker.io/library/my_first_docker			                                              0.0s 
                                                                                                            
What&#39;s Next?
View a summary of image vulnerabilities and recommendations → docker scout quickview
</pre></div>
</div>
  </p>
</div>
<p>As you can see from the output, the steps we defined in our Dockerfile are executed step by step, comparable to docker pull. And we can check if our image was actually created successfully by using the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">images</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    (base) Michaels-MacBook-Pro:my_first_docker me$ docker images
    REPOSITORY             TAG       IMAGE ID       CREATED          SIZE
    my_first_docker        latest    c1891eb763de   23 minutes ago   614MB
</pre></div>
</div>
<p><strong>5. Docker run</strong></p>
<p>The most basic way to run a container from the terminal is simply <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">imagename</span></code>, e.g. in :</p>
<p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">my_first_docker</span></code></p>
<p>This will result in our defined default behaviour (CMD [“cat”, “/info/README.md”]). As printing an informative READEME is always a great starting point for a reproducible pipeline, we’re doing exactly this here.</p>
<p>The output looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    (base) Michaels-MBP:my_first_docker me$ docker run my_first_docker
    # EEG Demographics Dataset

    ## Author
    - Name: Author
    - Date: 2024-03-09
    - Location: Frankfurt am Main, Germany

    ## Experiment Description
    This dataset is part of a study investigating …

    ## Dataset Contents
    The `demographics.csv` file contains demographic information of the EEG study participants, including:
    - `SubjectID`: Unique identifier for each participant.
    - `Age`: Age of the participant.
    - `Handedness`: “L” for left-, ”R” for righthanded

    ## Usage Instructions
    …

    ## Citing This Work
    If you use this dataset in your research, please cite it as follows:
    Lastname, F. (2024). Study Title. Frankfurt am Main, Germany. ORCID-ID

</pre></div>
</div>
<p>If Instead we want to run the python script in our containers <code class="docutils literal notranslate"><span class="pre">/info</span> <span class="pre">folder</span></code> we replace the default command, by including instructions in <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">...</span></code> substitution the first default argument of our CMD (cat) with <code class="docutils literal notranslate"><span class="pre">python3</span></code> as our executable, like so:</p>
<p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">my_first_docker</span> <span class="pre">python3</span> <span class="pre">/info/print_info_container.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">Date</span><span class="p">:</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span>
    <span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Docker</span> <span class="n">image</span> <span class="k">for</span> <span class="n">Your</span> <span class="n">Study</span> <span class="n">Title</span> <span class="n">Here</span><span class="o">.</span> <span class="n">Youll</span> <span class="n">find</span> <span class="nb">all</span> <span class="n">relevant</span> <span class="n">information</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">README</span> <span class="n">file</span> <span class="n">located</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">folder</span><span class="o">.</span>
</pre></div>
</div>
<p>No if we would want our container to work as a computing enviornment (i.e. to run python scripts) we simply modify the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command by providing a <code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">path</span></code>, i.e. a pointer for which directories of the host system should be made accessible to the container. Again, we do this by providing a <code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">-flag</span></code> (volume), a local file path and the working directory in our container, separated by <code class="docutils literal notranslate"><span class="pre">:</span></code>. If we want to mount our current working directory (<code class="docutils literal notranslate"><span class="pre">pwd</span></code> in bash) to the <code class="docutils literal notranslate"><span class="pre">/projects</span></code> folder in our container and run a local python script we can do:</p>
<p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-v</span> <span class="pre">$(pwd):/project</span> <span class="pre">my_first_docker</span> <span class="pre">python3</span> <span class="pre">print_info_local_systempy</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>where:   
    $(pwd) = local machine :
    /project = docker container  
    my_first_docker = imagename 
    python3 = executable 
    print_info_copy.py = filename
</pre></div>
</div>
<p>Resulting in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    (base) Michaels-MBP:my_first_docker me$ docker run -v $(pwd):/project my_first_docker python3 print_info_local_system.py
    Date: 2024-03-13
    Welcome to the Docker image for Your Study Title Here (Imported script via CMD). Youll find all relevant information in the README file located in this folder.

</pre></div>
</div>
</section>
<section id="virtualizing-a-workflow">
<h2>Virtualizing a workflow<a class="headerlink" href="#virtualizing-a-workflow" title="Link to this heading">#</a></h2>
<p>Of course most workflows will necessary be more complex, let’s look at another example.</p>
<ul class="simple">
<li><p>live demonstration</p></li>
</ul>
<p>– add !!Dockerfile!!</p>
</section>
<section id="neurodocker">
<h2>Neurodocker<a class="headerlink" href="#neurodocker" title="Link to this heading">#</a></h2>
<p>You might wonder: Isn’t there a sufficient, faster and easier way of composing Dockerfiles?
Well, say no more and meet <a class="reference external" href="https://www.repronim.org/neurodocker/user_guide/installation.html">Neurodocker</a>, a Docker container that targets the creation of Docker containers - Dockerception.</p>
<p>Even though Neurodocker was designed for (you might’ve guessed it already) Docker containers to utilize in the realm of neuroscience, it’s also a very handy tool for any other research field, as especially the basic setup is done very quickly and hassle-free.</p>
<p>So, let’s see how we can create our Dockerfiles using <code class="docutils literal notranslate"><span class="pre">Neurodocker</span></code>. At first we have to get the Neurodocker image using the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span> <span class="pre">command</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>aaronreer@FK6P-1158240:~$ docker pull repronim/neurodocker:0.9.5
0.9.5: Pulling from repronim/neurodocker
8a49fdb3b6a5: Already exists
0357922e53aa: Already exists
9a0b2b81bdd7: Already exists
1bed10bb162b: Already exists
61479f8dd1a7: Already exists
5fca58cb4537: Already exists
76b5b227fa86: Already exists
Digest: sha256:3d4ae0b3e6f0767ad2ea3dc401b4a011c354a682eb9db4a9c18bcee2cbd7cddb
Status: Downloaded newer image for repronim/neurodocker:0.9.5
docker.io/repronim/neurodocker:0.9.5
</pre></div>
</div>
<p>All we have to do now is run Neurodocker, providing the necessay input arguments beginning with stating that we want to create a Docker container and that we want to use <code class="docutils literal notranslate"><span class="pre">neurodebian:bullseye</span></code> as a base and apt as package manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>aaronreer@FK6P-1158240:~$ docker run repronim/neurodocker:0.9.5 generate docker \
--base-image ubuntu:latest \
--pkg-manager apt \

</pre></div>
</div>
<p>Next, we specify all the Linux packages that we want to have installed in our image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>aaronreer@FK6P-1158240:~$ docker run repronim/neurodocker:0.9.5 generate docker \
--base-image ubuntu:latest \
--pkg-manager apt \
--install git nano \

</pre></div>
</div>
<p>Now, we are only missing the python part…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>aaronreer@FK6P-1158240:~$ docker run repronim/neurodocker:0.9.5 generate docker \
--base-image ubuntu:latest \
--pkg-manager apt \
--install git nano \
--miniconda version=latest env_name=myenvironmentname \
conda_install=&quot;python=3.11 numpy pandas&quot; \
pip_install=&quot;mne&quot;
</pre></div>
</div>
<p>Great! We have all the information that we need. Hence, let’s run the <code class="docutils literal notranslate"><span class="pre">Neurodocker</span></code> container parsing the output to a file called ‘Dockerfile’. We can do so using the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> operator :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>aaronreer@FK6P-1158240:~/data$ docker run repronim/neurodocker:0.9.5 generate docker \
--base-image ubuntu:latest \
--pkg-manager apt \
--install git nano \
--miniconda version=latest env_name=myenvironmentname \
conda_install=&quot;python=3.11 numpy pandas&quot; \
pip_install=&quot;mne&quot; &gt; Dockerfile
</pre></div>
</div>
<p>So using Neurodocker can save you a lot of time and stress. It’s especially great to set up the basics of your Docker container, so one approach to create a Docker container for your workflow may be to do the basics with Neurodocker and fine-tune to your needs manually.</p>
</section>
<section id="neurodocker-going-further-beyond">
<h2>Neurodocker - Going further beyond<a class="headerlink" href="#neurodocker-going-further-beyond" title="Link to this heading">#</a></h2>
<p>Check-out the examples on the <a class="reference external" href="https://www.repronim.org/neurodocker/user_guide/examples.html">Neurodocker site</a>, to see how to incorporate most neuroscience relevant packages into a Docker container.</p>
<p>Additionally, you should check-out their <a class="reference external" href="https://www.repronim.org/neurodocker/user_guide/cli.html">command-line-interface section</a> to see how to best make use of Neurodocker.</p>
<p><strong>Note</strong> If your server system doesn’t support docker, Neurodocker also allows for the creation of singularity images using mostly the same syntax as above!</p>
</section>
<section id="docker-push">
<h2>Docker push<a class="headerlink" href="#docker-push" title="Link to this heading">#</a></h2>
<p>Now this is where we could stop if we just want to make a quick reproducible solution for our basic workflows. But we, of course, want to additionally enable open and community-driven science, by getting our containerized workflows out there, but how do we do that?</p>
<p>In general, we can simply share our Dockerfile or created image (use the export/import functionality - Docker save/load) via e.g. USB or email.
But our preferred solution should be to make use of this thing called “internet” and share our Docker container on Docker Hub, making it available to everyone. Just make sure that nothing sensitive is contained in your container.</p>
<p>This is again rather straightforward and can be achieved in a few simple steps.</p>
<ol class="arabic simple">
<li><p>Create and login to your Docker Hub account</p></li>
</ol>
<p>Before you can push an image, you need to log in to Docker Hub. Simply create an account online, run  <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">login</span></code> from your command line and enter your Docker Hub username and password.</p>
<ol class="arabic simple" start="2">
<li><p>Tag your image</p></li>
</ol>
<p>After building our image, we need to <code class="docutils literal notranslate"><span class="pre">tag</span></code> it, in order to make it identifiable online. Tags can be anything, but should be meaningful file and version names (1.0 etc. or “latest” are common). The general form of the tag command is e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">docker</span> <span class="n">tag</span> <span class="n">image</span><span class="o">-</span><span class="nb">id</span> <span class="n">username</span><span class="o">/</span><span class="n">repository</span><span class="p">:</span><span class="n">tag</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">image-id</span></code> is the name provided when building your image, <code class="docutils literal notranslate"><span class="pre">username</span></code> is your Docker Hub username, <code class="docutils literal notranslate"><span class="pre">repository</span></code> is the repository or folder on your Docker Hub where your container is supposed to be stored and <code class="docutils literal notranslate"><span class="pre">tag</span></code> is of course the specific version name. So this could look like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">docker</span> <span class="n">tag</span> <span class="n">myworkflowimage</span> <span class="n">mernst</span><span class="o">/</span><span class="n">workflow</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Docker push
Next we simply use the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">push</span></code> command to send our freshly tagged Docker container to Docker Hub, e.g.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">docker</span> <span class="n">push</span> <span class="n">yourhubusername</span><span class="o">/</span><span class="n">container</span><span class="p">:</span><span class="n">tag</span>
</pre></div>
</div>
</section>
<section id="docker-containers-creating-and-pushing-a-recap">
<h2>Docker containers - creating and pushing - a recap<a class="headerlink" href="#docker-containers-creating-and-pushing-a-recap" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Creating and sharing Docker containers is achieved through three parts: a <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code>, the <code class="docutils literal notranslate"><span class="pre">build</span></code> and the <code class="docutils literal notranslate"><span class="pre">push</span></code> command.</p></li>
<li><p>Dockerfiles can either be created completely manually or supported by neurodocker</p></li>
<li><p>using docker build, the Docker container is created following the information in the Dockerfile</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">myfirstdocker</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">directory</span><span class="o">/</span><span class="n">containing</span><span class="o">/</span><span class="n">Dockerfile</span>
</pre></div>
</div>
<ul class="simple">
<li><p>once build, the Docker container should be tagged and subsequently pushed to Docker Hub</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">docker</span> <span class="n">tag</span> <span class="n">image</span><span class="o">-</span><span class="nb">id</span> <span class="n">yourhubusername</span><span class="o">/</span><span class="n">container</span><span class="p">:</span><span class="n">tag</span>
<span class="n">docker</span> <span class="n">push</span> <span class="n">yourhubusername</span><span class="o">/</span><span class="n">container</span><span class="p">:</span><span class="n">tag</span>

</pre></div>
</div>
<ul class="simple">
<li><p>the build and push process can be automatized using a combination of Docker Hub and GitHub. More info in the <a class="reference external" href="https://m-earnest.github.io/docker_workshop/advanced/automating.html">Automating software containers</a> session.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./advanced"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="management.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Management of software containers</p>
      </div>
    </a>
    <a class="right-next"
       href="data.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Software containers &amp; data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-there-and-back-again">Docker - there and back again</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-containers-the-creation">Docker containers - the creation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dockerfiles">Dockerfiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-dockerfile">Building a Dockerfile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-baseimage">1. FROM - Baseimage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#workdir-working-directory">2. WORKDIR - working directory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-install-software-execute-commands">3. RUN - install software, execute commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copy-add-files-to-image">4. COPY - add files to image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#entrypoint-and-cmd-make-the-image-exectuable">5. Entrypoint and CMD - make the image exectuable</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-example">Practical example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#virtualizing-a-workflow">Virtualizing a workflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#neurodocker">Neurodocker</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#neurodocker-going-further-beyond">Neurodocker - Going further beyond</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-push">Docker push</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-containers-creating-and-pushing-a-recap">Docker containers - creating and pushing - a recap</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aaron Reer, Peer Herholz, Michael Ernst
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>